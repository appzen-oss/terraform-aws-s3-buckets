{
  "Sid": "Prevent put objects without correct encryption",
  "Effect": "Deny",
  "Principal": "*",
  "Action": [
    "s3:PutObject"
  ],
  "Resource": "${s3_bucket_arn}/*",
  "Condition": {
    "StringNotEquals": {
      "s3:x-amz-server-side-encryption": "${kms ? "aws:kms" : "AES256"}"
    }
  }
},
{
  "Sid": "Prevent Unencrypted Object Uploads",
  "Effect": "Deny",
  "Principal": "*",
  "Action": [
    "s3:PutObject"
  ],
  "Resource": "${s3_bucket_arn}/*",
  "Condition": {
    "Null": {
      "s3:x-amz-server-side-encryption": "true"
    }
  }
}
